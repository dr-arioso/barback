id: stashkit.resolvers
name: Resolver Subsystem
type: subsystem
description: >
  Resolves user requests by orchestrating skills, consulting StashDexes,
  and assembling coherent entities suitable for persistence in Stashes.

traits:
  - orchestrates_skills
  - domain_aware
  - input_interpreter
  - entity_builder

fields:
  responsibilities:
    - Gather raw or partial inputs from multiple signal sources.
    - Invoke appropriate skills in a configured or dynamic sequence.
    - Maintain partial entities and confidence models while merging proposals.
    - Consult StashDexes for normalization, classification, and enrichment.
    - Decide when resolution is sufficient using domain-specific termination rules.
    - Produce structured domain entities ready to be stored in Stashes.
  typical_fields:
    - domain
    - target_entity_type
    - required_fields
    - optional_fields
    - skill_sequence
    - termination_rules
    - conflict_resolution_strategy
    - supported_dexes

api:
  public_methods:
    - name: resolve
      description: >
        Interpret a request by gathering signals, applying skills, consulting StashDexes,
        and building a structured entity.
      params:
        - request
        - stash
        - options
      returns: "PartialEntity | StructuredEntity"

  internal_methods:
    - name: _apply_skills
      description: "Construct the skill chain and apply it, updating the partial entity and confidence model."
    - name: _score_candidates
      description: "Score and rank candidate entities based on confidence and domain rules."

  properties:
    - name: domain
      description: "The domain or entity type handled by this resolver (e.g. product, bottle, herb, item)."
    - name: target_entity_type
      description: "The concrete entity class or schema the resolver attempts to produce."
    - name: required_fields
      description: "Field names that must be populated before the resolver considers an entity complete."
    - name: optional_fields
      description: "Field names that may be populated when available but are not required for completion."
    - name: skill_sequence
      description: "Ordered or conditional sequence of skills that this resolver may invoke."
    - name: termination_rules
      description: "Rules that describe when resolution should stop."
    - name: conflict_resolution_strategy
      description: "Strategy for reconciling conflicting proposals from skills or Dex lookups."
    - name: supported_dexes
      description: "Identifiers of StashDexes this resolver knows how to consult."

  events:
    - name: on_ambiguous_match
      description: "Fired when multiple entities or interpretations match with similar confidence."
    - name: on_resolution_complete
      description: "Fired when the resolver produces a complete entity."
    - name: on_partial_resolution
      description: "Fired when resolution stops with a partial entity."
